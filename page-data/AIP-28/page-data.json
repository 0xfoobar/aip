{"componentChunkName":"component---src-templates-aip-post-js","path":"/AIP-28/","result":{"data":{"site":{"siteMetadata":{"title":"Aave Improvement Proposals","siteUrl":"https://aave.github.io/aip"}},"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFDUlEQVQ4y3WU+VNTVxTH34z/Aj/Jn9Bp7bQdWoprHa11R7EBCUsIIiigLIKCS1RAoyhoXgSEJGRPXpKXfQ8QYmIzoNSKSztSa5WMUOyMmf6Ux8s9vXkRpu1Mz8ydeXc5n3fPPed8ieNiJ9F5jiYy1nLZvob4YOJm09qbjUYBWacn7x7R0aMCDa3lq0iqWCmwFinWrpxzFco5HwtvlHDvkxNEmdTLbTRecXIbneesORc6LGT3KXPydpsDhltdIG+wgqbOApYaK1grKDDzRpP2gwrSs0+W80+o7ZAi+5e66y5u4WSPo6Dtom2+qzsIlzqs0NNqYm80UYyk0cgOHTOwsmodo6pQs8ZSNQT4JnAckM9jaAEH3Z+FEtV9bu7j6A33+nqxc/mU2AftIlvq7FkaXT5jQV0njai7RoOuC1RIKtQgebUWqcvVyHBYmXIVa8FZKF/G0PUZhnsFypf6cqpueRLHbgeh4aqTae5ywGmRDbW3UYi85gMf9QBChmlQX3ABWaFCiiot0pSrwViiZNw8LeCQE7692fA5Kx70k0JFFIT9nlRtrxtOiJ2o4TyNbK5HsLzMwoplviPGByCtVKFRDNWWqYEqUaZCh6kMlORge0dDuQdHgsmSu0EoJ73pI7e8qKrHjm5pYqsgQJmBVqe2vjGQliuRMgPlq9KWEhXgJCXxO+YSO9VjggOGGBSNBNiSQT+qlPoQ/6odoo9fc84a+gH88e4v+BMPWhvn1p7FX0J/pQpkNTqkrNQgXamKdZcawFakEBDb9BOSvbZp2KcIMYeGA6h0wA+lfW6YmVvgnIcNcUgsJGERDx1+lozNzSbgZq0OBmr1MCLUImWFmnEKLJlykhCbTWF6hy0O+KbsfkUIfT8cAJ7EA9Nzb1dDfPFqCZ6/WFid//J4HsT1epDUG2DwqA7JhFrWJDSBvlRFEwXWSXqrawq268fZXeoxVKgIwYEBH0z9mgWwaQQMw0IKj3Q6za39PDsPuJzg5gkKJMcNaLBGx+qOWgCXE0186bhHbgr+CFuoMPOtbhztUY3BnmE/xF9mgctsOpuTDJzNAp89SYCohQJxiwlweyLymJ7R1ttBXqWREJ+7o4L84EPYQE+y31BhtANDd8gD8MOrRfg/e/osAZ3tZuhuN6NrzSbUhztppNEKQzU6AfGJP5b7mSea/MoVg42WyfRW4wTapg6hiZdvYeb1ErxaSsKTN+/g+e9L8HrxPTydW4SZ2TfQjjtJ1EGj7jZzurfZDP0NxvdYSLKisc4fI/MijyHfHkltskzCZnzLid8WkMg/A5LwLBxXh6FJPg4y3yOQUHGYeTKPWkRW1HneCqIzllT/WS9ca6LI1U75KHg/Z50vlsgLTsHXtgizwRSGxuBDxKMiaJcsAAeH/FAs9QIfl9PJOwHUq4miE112wELCiC664OJpS+JKqynbejhkrqE/DtwvwNDlvMAUFFgjqXzDeHorvunubOYRD9co/44PVfR7kEDsSGMhSX0QEgYLCac4FzroNf+Frv/UG0vkh3+CjY4obDGFWZx5ZrdqjC2UBVnekJ8pk/rYatIPjXcmM0KSaO6yc0pz5rw1C/vCHc2+o28VmoOTJMHllNzknYbtnoewk47Dfuo+8HDX8JURKCO9SWGfR1Lb6+LCPHUpq/Q9bWYM8MeIPNe9f0EzhsspFydJgDNP4szT32nGaCwkZNFwQFAy4MtdOYdFmfPBKkXg8Im/Adw6zkzX1w4vAAAAAElFTkSuQmCC","width":30,"height":30,"src":"/aip/static/689aad3b5746be423e8a551069ccd17b/91664/logo.png","srcSet":"/aip/static/689aad3b5746be423e8a551069ccd17b/91664/logo.png 1x,\n/aip/static/689aad3b5746be423e8a551069ccd17b/ad39b/logo.png 1.5x,\n/aip/static/689aad3b5746be423e8a551069ccd17b/183c2/logo.png 2x"}}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/AIP-37/"},"frontmatter":{"status":"Proposed","aip":37,"title":"Update to the Liquidity Mining Distribution"}}},{"node":{"fields":{"slug":"/AIP-35/"},"frontmatter":{"status":"Proposed","aip":35,"title":"Adjust interest rate to account for APY over-approximation"}}},{"node":{"fields":{"slug":"/AIP-33/"},"frontmatter":{"status":"Proposed","aip":33,"title":"Add FEI to Aave V2"}}},{"node":{"fields":{"slug":"/AIP-32/"},"frontmatter":{"status":"Proposed","aip":32,"title":"Extend Liquidity Incentives for Aave v2"}}},{"node":{"fields":{"slug":"/AIP-29/"},"frontmatter":{"status":"Proposed","aip":29,"title":"Add FRAX to Aave V2"}}},{"node":{"fields":{"slug":"/AIP-28/"},"frontmatter":{"status":"Proposed","aip":28,"title":"Polygon Cross-chain Governance Test"}}},{"node":{"fields":{"slug":"/AIP-27/"},"frontmatter":{"status":"Proposed","aip":27,"title":"Lower Reserve Factor for AMPL"}}},{"node":{"fields":{"slug":"/AIP-26/"},"frontmatter":{"status":"Proposed","aip":26,"title":"Raise Maximum Interest Rate on AMPL Market"}}},{"node":{"fields":{"slug":"/AIP-25/"},"frontmatter":{"status":"Proposed","aip":25,"title":"Extend Liquidity Incentives for Aave v2"}}},{"node":{"fields":{"slug":"/AIP-24/"},"frontmatter":{"status":"WIP","aip":24,"title":"Add PAX to Aave V2"}}},{"node":{"fields":{"slug":"/AIP-23/"},"frontmatter":{"status":"Proposed","aip":23,"title":"Add BarnBridge (BOND) to Aave"}}},{"node":{"fields":{"slug":"/AIP-22/"},"frontmatter":{"status":"Proposed","aip":22,"title":"Add RAI to Aave V2"}}},{"node":{"fields":{"slug":"/AIP-21/"},"frontmatter":{"status":"Proposed","aip":21,"title":"Set Reserve Factors for GUSD and CRV"}}},{"node":{"fields":{"slug":"/AIP-20/"},"frontmatter":{"status":"Proposed","aip":20,"title":"Safety Incentives Implementation"}}},{"node":{"fields":{"slug":"/AIP-19/"},"frontmatter":{"status":"Proposed","aip":19,"title":"Whitelist Curve Liquidity Mining Claim"}}},{"node":{"fields":{"slug":"/AIP-18/"},"frontmatter":{"status":"Proposed","aip":18,"title":"Aavenomics quarterly upgrade Q2 2021"}}},{"node":{"fields":{"slug":"/AIP-17/"},"frontmatter":{"status":"Proposed","aip":17,"title":"Aave Grants DAO"}}},{"node":{"fields":{"slug":"/AIP-16/"},"frontmatter":{"status":"Proposed","aip":16,"title":"introduce Liquidity Incentives for Aave v2"}}},{"node":{"fields":{"slug":"/AIP-15/"},"frontmatter":{"status":"Proposed","aip":15,"title":"Upgrade Aave V1 repayment for migration tool"}}},{"node":{"fields":{"slug":"/AIP-14/"},"frontmatter":{"status":"Proposed","aip":14,"title":"Enable borrowing on renFIL"}}},{"node":{"fields":{"slug":"/AIP-13/"},"frontmatter":{"status":"Proposed","aip":13,"title":"Add renFIL support to Aave"}}},{"node":{"fields":{"slug":"/AIP-12/"},"frontmatter":{"status":"Proposed","aip":12,"title":"Adding AMPL on AAVE"}}},{"node":{"fields":{"slug":"/AIP-11/"},"frontmatter":{"status":"Proposed","aip":11,"title":"desactivation of Aave V1 stable rate borrowing"}}},{"node":{"fields":{"slug":"/AIP-10/"},"frontmatter":{"status":"WIP","aip":10,"title":"Adding xSushi on AAVE"}}},{"node":{"fields":{"slug":"/AIP-9/"},"frontmatter":{"status":"Proposed","aip":9,"title":"Activation of the Aave Balancer Pool Liquidity Staking"}}},{"node":{"fields":{"slug":"/AIP-8/"},"frontmatter":{"status":"Proposed","aip":8,"title":"Adding BAL on AAVE"}}},{"node":{"fields":{"slug":"/AIP-7/"},"frontmatter":{"status":"Proposed","aip":7,"title":"Aavenomics Quarterly Upgrade"}}},{"node":{"fields":{"slug":"/AIP-6/"},"frontmatter":{"status":"Implemented","aip":6,"title":"Adding GUSD on AAVE"}}},{"node":{"fields":{"slug":"/AIP-5/"},"frontmatter":{"status":"Implemented","aip":5,"title":"Adding CRV on AAVE"}}},{"node":{"fields":{"slug":"/AIP-4/"},"frontmatter":{"status":"Implemented","aip":4,"title":"Activation of Aave Protocol Governance V2"}}},{"node":{"fields":{"slug":"/AIP-3/"},"frontmatter":{"status":"Implemented","aip":3,"title":"V1 upgrades for seamless transition to AAVE v2"}}},{"node":{"fields":{"slug":"/AIP-2/"},"frontmatter":{"status":"Implemented","aip":2,"title":"Bootstrap of the AAVE Governance Fund"}}},{"node":{"fields":{"slug":"/AIP-1/"},"frontmatter":{"status":"Implemented","aip":1,"title":"LEND/AAVE migration and activation of the Safety Module"}}}]},"markdownRemark":{"id":"cea7a458-263a-5a28-ad9f-298f71cadfa9","excerpt":"Simple Summary The intention of this AIP is to test a cross-chain transaction workflow that would enable the Ethereum based smart contract for governance for…","html":"<h2>Simple Summary</h2>\n<p>The intention of this AIP is to test a cross-chain transaction workflow that would enable the Ethereum based smart contract for governance for the Aave Protocol (the “Aave Ethereum Governance”) to control the deployment of the Aave Protocol on Polygon (the “Aave Polygon market”). The proposal is written as a transaction that would make updates to a <strong>mock</strong> Aave Polygon market. If approved, the transaction would trigger a cross-chain message, flowing from Aave’s Ethereum Governance, to a new contract - the <code class=\"language-text\">PolygonBridgeExecutor</code>. The <code class=\"language-text\">PolygonBridgeExecutor</code> would store the proposed market updates for a delay window, and then allow for the updates to be executed on the <strong>mock</strong> Aave Polygon market.</p>\n<p>This proposal will allow testing the end-to-end crosschain transaction workflow for Polygon market governance using both the Ethereum and Polygon mainnet contracts in a way that cannot be replicated in another manner. This test will support the case in the future to transfer ownership of the Aave Polygon Market to Aave’s Ethereum  governance.</p>\n<p><strong>In-Scope:</strong>\nA test of the governance cross-chain bridge functionality on a <strong>mock</strong> Aave Polygon market.</p>\n<p><strong>Out-of-Scope:</strong>\nTransferring ownership of the Aave Polygon Market to the Aave Ethereum Governance </p>\n<h2>Abstract</h2>\n<p>Test an implementation of a cross-chain governance workflow, allowing Aave’s Ethereum Governance to execute a transaction updating a <strong>mock</strong> Aave market deployed on Polygon.</p>\n<h2>Motivation</h2>\n<p>Before anyone in the community or otherwise can make a proposal to transfer ownership of the Aave Polygon market to a cross-chain bridge workflow, it is necessary that any smart contracts be tested as thoroughly as possible. This AIP is a <code class=\"language-text\">real world</code> test using the Aave Ethereum Governance contract to test the cross-chain bridge contracts on a <strong>mock</strong> Aave Polygon Market. The main reasons for testing to this extent are:</p>\n<ul>\n<li>Cross-chain / bridge transactions are relatively new and complex</li>\n<li>The risk of this workflow being deployed and not operating correctly would have a HIGH impact</li>\n</ul>\n<p>The transfer of ownership of the Aave Polygon Market to Aave’s Ethereum Governance is <strong>not</strong> in-scope of this AIP, but understanding the motivation behind that desired change is important to understanding the motivation for this test.</p>\n<p>The current owner of the Aave Polygon Market a multi-sig wallet due to the time needed to build a cross-chain governance platform, as well as ensuring security for a new deployment on a new network.</p>\n<p>Given the overarching goal that any deployment of the Aave Protocol be owned by decentralized governance, transferring ownership of the Aave Polygon market contracts to Aave Ethereum Governance, is an important next step. Additionally, we have developed and deployed a cross-chain governance platform aimed at providing a broad solution for cross-chain governance. After appropriate testing (including this AIP) and auditing of the cross-chain bridge contract, anyone can create a future AIP to remove the multi-sig over the Aave Polygon market and transfer ownership of those smart contracts to Aave Ethereum Governance.</p>\n<h2>Specification</h2>\n<p>A detailed specification of the crosschain-bridge contract and workflow is outlined in the repo here</p>\n<p><a href=\"https://github.com/Aave/governance-crosschain-bridges\">https://github.com/Aave/governance-crosschain-bridges</a></p>\n<p>For this test specifically, the test would flow from Aave Ethereum Governance, through a cross chain transaction to the <code class=\"language-text\">PolygonBridgeExecutor</code> contract. Then after a delay, the proposal would be executed on Polygon to make updates to the <strong>mock</strong> Aave Polygon market.</p>\n<p>The general flow of this test will be</p>\n<ol>\n<li>Propose cross-chain test transactions (Aave governance-v2)</li>\n<li>Vote on cross-chain test transactions (Aave governance-v2)</li>\n<li>Queue test transactions</li>\n<li>Execute cross-chain test transactions<br>\n4a. Execute transaction from Aave Governance (Aave governance-v2)<br>\n4b. Bridge the test transactions to Polygon  (Polygon fxPortal and Polygon Inherent Bridge Functionality)<br>\n4c. Receive bridged message on Polygon       (Polygon fxPortal and Polygon Inherent Bridge Functionality)<br>\n4d. Queue transactions for execution in PolygonBridgeExecutor (Aave governance-crosschain-bridges)\\</li>\n<li>Wait for delay</li>\n<li>Execute queued transactions in the PolygonBridgeExecutor   (Aave governance-crosschain-bridges)<br>\n6a. Turn off borrowing for the <strong>mock</strong> Dai reserve<br>\n6b. Transfer POOL_ADMIN rights to a dummy address<br>\n6c. Transfer ownership of the <strong>mock</strong> Aave market to a dummy address\\</li>\n<li>Confirm the expected updates have been made on <strong>mock</strong> Aave market</li>\n</ol>\n<h2>Rationale</h2>\n<p>This AIP will not make any actual changes in the current Aave Polygon market ecosystem or in any other deployment of the Aave Protocol. It is merely a test of a contract and workflow that, in the future, could enable the Aave Ethereum Governance to control the Aave Polygon Market.</p>\n<p>Testing the contracts that enable this cross-chain bridging as thoroughly as possible, including via this proposed test are rationale, despite their cost, given the critical role the cross-chain bridging will play if deployed and used for cross-chain governance.</p>\n<h2>Test Cases</h2>\n<p>A full suit of tests with 100% coverage is included in the repo <a href=\"https://github.com/Aave/governance-crosschain-bridges\">https://github.com/Aave/governance-crosschain-bridges</a>. The cross-chain workflow has also successfully been tested on the Goerli-Mumbai test networks.</p>\n<h2>Implementation</h2>\n<p>A mock implementation of this proposed test can be found here:</p>\n<p><a href=\"https://github.com/Aave/governance-crosschain-bridges/tree/feat/mainnet-test\">https://github.com/Aave/governance-crosschain-bridges/tree/feat/mainnet-test</a></p>\n<p>After setting up the repository: </p>\n<p><code class=\"language-text\">npm run hardhat mock-mainnet-proposal-delegate</code>\nruns on Ethereum fork to makes sure everything is encoded correctly to be submitted for the proposal</p>\n<p><code class=\"language-text\">npm run hardhat mock-Polygon-test-delegate</code>\nset a .env variable <code class=\"language-text\">Polygon_FORK = &quot;true&quot;</code> to run the test updating the Polygon market via the mainnet PolygonBridgeExecutor on a Polygon fork</p>\n<p>Two helper contracts have been deployed to support this proposal. <code class=\"language-text\">PolygonMessageSender</code> has been deployed on Ethereum and <code class=\"language-text\">PolygonMarketUpdate</code> has been deployed on Polygon.</p>\n<p>This proposal, if executed, calls the function sendMessage() on the <code class=\"language-text\">PolygonMessageSender</code> contract on Ethereum mainnet via a delegatecall. The sendMessage function encodes a delegatecall to the function executeUpate() on the contract <code class=\"language-text\">MarketUpdate</code> deployed on the Polygon network and then sends that encoded action to the <code class=\"language-text\">PolygonBridgeExecutor</code> on the Polygon network via Polygon’s FxPortal. When that action is received in the PolygonBridgeExecutor, it will be queued. After a delay, that action can be executed, calling the function executeUpate() which will make three updates to a mock aave market deployed on Polygon:</p>\n<ol>\n<li>disable the mock dai reserve via the LendingPoolConfigurator contract</li>\n<li>Set the pool admin to the address <code class=\"language-text\">0x000000000000000000000000000000000000dEaD</code> via the LendingPoolAddressesProvider contract</li>\n<li>Transfer ownership of the pool to the address <code class=\"language-text\">0x0000000000000000000000000000000000000001</code> via the LendingPoolAddressesProvider contract</li>\n</ol>\n<p><strong>Related Contracts:</strong></p>\n<p><em>Ethereum PolygonMessageSender Contract</em>\nPolygonMessageSender: <code class=\"language-text\">0xf442C0faE2E9A157cD0202BD63bf9b932D3aa4C8</code> <br>\n<a href=\"https://etherscan.io/address/0xf442C0faE2E9A157cD0202BD63bf9b932D3aa4C8#code\">https://etherscan.io/address/0xf442C0faE2E9A157cD0202BD63bf9b932D3aa4C8#code</a> \\</p>\n<p><em>Polygon FxPortal Bridge Contracts</em><br>\nFxRoot: <code class=\"language-text\">0xfe5e5D361b2ad62c541bAb87C45a0B9B018389a2</code> <br>\n<a href=\"https://etherscan.io/address/0xfe5e5D361b2ad62c541bAb87C45a0B9B018389a2#code\">https://etherscan.io/address/0xfe5e5D361b2ad62c541bAb87C45a0B9B018389a2#code</a> <br>\nStateSender: <code class=\"language-text\">0x28e4F3a7f651294B9564800b2D01f35189A5bFbE</code> <br>\n<a href=\"https://etherscan.io/address/0x28e4f3a7f651294b9564800b2d01f35189a5bfbe#code\">https://etherscan.io/address/0x28e4f3a7f651294b9564800b2d01f35189a5bfbe#code</a> <br>\nFxChild: <code class=\"language-text\">0x8397259c983751DAf40400790063935a11afa28a</code> <br>\n<a href=\"https://polygonscan.com/address/0x8397259c983751DAf40400790063935a11afa28a#code\">https://polygonscan.com/address/0x8397259c983751DAf40400790063935a11afa28a#code</a></p>\n<p><em>Polygon Bridge Executor Contracts</em><br>\nPolygonBridgeExecutor: <code class=\"language-text\">0x60966EA42764c7c538Af9763Bc11860eB2556E6B</code><br>\n<a href=\"https://polygonscan.com/address/0xd63b6b5e0f043e9779c784ee1c14ffcbffb98b70#code\">https://polygonscan.com/address/0xd63b6b5e0f043e9779c784ee1c14ffcbffb98b70#code</a></p>\n<p><em>Polygon Market Update</em><br>\nMarketUpdate: <code class=\"language-text\">0x5b494b94faf0bb63254dba26f17483bcf57f6d6a</code> <br>\n<a href=\"https://polygonscan.com/address/0x5b494b94faf0bb63254dba26f17483bcf57f6d6a#code\">https://polygonscan.com/address/0x5b494b94faf0bb63254dba26f17483bcf57f6d6a#code</a></p>\n<p><em>Mock Polygon Market Contracts</em><br>\nLendingPoolAddressProviderAddress = <code class=\"language-text\">0x240de965908e06a76e1937310627b709b5045bd6</code><br>\n<a href=\"https://polygonscan.com/address/0x240de965908e06a76e1937310627b709b5045bd6#code\">https://polygonscan.com/address/0x240de965908e06a76e1937310627b709b5045bd6#code</a> <br>\nLendingPoolConfiguratorAddress (proxy)= <code class=\"language-text\">0xd63B6B5E0F043e9779C784Ee1c14fFcBffB98b70</code> <br>\n<a href=\"https://polygonscan.com/address/0xd63b6b5e0f043e9779c784ee1c14ffcbffb98b70#writeContract#code\">https://polygonscan.com/address/0xd63b6b5e0f043e9779c784ee1c14ffcbffb98b70#writeContract#code</a> <br>\nLendingPoolConfiguratorAddress (implementation)= <code class=\"language-text\">0xADA061366575324945c7a097F829349acA6C9aB9</code> <br>\n<a href=\"https://polygonscan.com/address/0xADA061366575324945c7a097F829349acA6C9aB9#code\">https://polygonscan.com/address/0xADA061366575324945c7a097F829349acA6C9aB9#code</a></p>\n<h2>Copyright</h2>\n<p>Copyright and related rights waived via <a href=\"https://creativecommons.org/publicdomain/zero/1.0/\">CC0</a>.</p>","frontmatter":{"aip":28,"title":"Polygon Cross-chain Governance Test","status":"Proposed","author":"Steven Valeri (@stevenvaleri)","discussions":"N/A","created":"July 30, 2021","updated":null}}},"pageContext":{"slug":"/AIP-28/","previous":{"fields":{"slug":"/AIP-27/"},"frontmatter":{"title":"Lower Reserve Factor for AMPL","status":"Proposed","aip":27}},"next":{"fields":{"slug":"/AIP-29/"},"frontmatter":{"title":"Add FRAX to Aave V2","status":"Proposed","aip":29}}}}}